<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generating BreweryDB API Functions • brewerydb</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Generating BreweryDB API Functions">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">brewerydb</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/articles/brewerydb.html">Generating BreweryDB API Functions</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/samterfa/brewerydb">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Generating BreweryDB API Functions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/samterfa/brewerydb/blob/master/vignettes/articles/brewerydb.Rmd"><code>vignettes/articles/brewerydb.Rmd</code></a></small>
      <div class="hidden name"><code>brewerydb.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level3">
<h3 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h3>
<p><br></p>
<p>An API or Application Program Interface is a standard tool for creating software applications. There are many well-known APIs such as the Google APIs backing Docs, Drive, Calendar, Assistant and <a href="https://developers.google.com/apis-explorer/">lots more</a>. The purpose of this article is to explain how to automatically generate a package containing human-readable functions which utilize the <a href="https://www.brewerydb.com/developers">BreweryDB API</a>. This will allow us to search the BreweryDB database and find all sorts of data on beer and breweries!</p>
<p><br></p>
<p>Generally, the API documentation provided by websites is automatically generated in HTML to product documenation pages. We will in a way reverse engineer this process, scraping HTML documentation and pulling out the API methods and objects. A method is an action while an object is the thing that a method acts on.</p>
<p><br></p>
<div class="figure">
<img src="images/exampleAPIdoc.png" alt=" Example of HTML Documentation for an API"><p class="caption"><br><i>Example of HTML Documentation for an API</i></p>
</div>
<p><br></p>
</div>
<div id="api-calls" class="section level3">
<h3 class="hasAnchor">
<a href="#api-calls" class="anchor"></a>API Calls</h3>
<p><br></p>
<p>To make an API call, we use the <a href="https://cran.r-project.org/web/packages/httr/vignettes/quickstart.html">httr package</a> to perform the request. We will need to specify the API method (GET, POST, PUT and DELETE) and the endpoint URL where we will send our request. Additionally, each API has special ways of giving permission for you to access their API. To make API calls to the BreweryDB API, we need to obtain a “key” and attach it as a query parameter to our call. To obtain your own, follow the <a href="https://www.brewerydb.com/developers">developer instructions</a>.</p>
<p><br></p>
<p>Here’s code I use to check my authentication when working with APIs.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  checkAuthentication &lt;-<span class="st"> </span><span class="cf">function</span>(){
  
    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/message">suppressPackageStartupMessages</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(httr))
    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/message">suppressPackageStartupMessages</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(jsonlite))
    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/message">suppressPackageStartupMessages</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(tidyverse))
    
    ops &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Sys.getenv">Sys.getenv</a></span>()
    requiredOptions &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"brewerydbKey"</span>)
    
    <span class="cf">for</span>(option <span class="cf">in</span> requiredOptions){
      <span class="cf">if</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Sys.getenv">Sys.getenv</a></span>(option) <span class="op">==</span><span class="st"> ''</span>){
        <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/stop">stop</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">'Required option '</span>, option, <span class="st">' has not been set! Set its value using Sys.setenv('</span>, option, <span class="st">' = "{'</span>, option, <span class="st">'Value}").'</span>))
      }
    }
  }

  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/try">try</a></span>({<span class="kw">checkAuthentication</span>()})</code></pre></div>
<pre><code>## Error in checkAuthentication() : 
##   Required option brewerydbKey has not been set! Set its value using Sys.setenv(brewerydbKey = "{brewerydbKeyValue}").</code></pre>
<p><br></p>
<p>I have a file which is placed in my .gitignore which sets my API credentials for a session but isn’t inadvertently posted to GitHub!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/source">source</a></span>(<span class="st">'../../apiCredentials.R'</span>)</code></pre></div>
<p><br></p>
<p>And here’s code to make an API call using BrewerDB’s syntax. I’ve added some features we’ll need later.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="co"># This function makes a BreweryDB API request.</span>
  makeRequest &lt;-<span class="st"> </span><span class="cf">function</span>(endpoint, verb, <span class="dt">params =</span> <span class="ot">NULL</span>){
  
    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/message">suppressPackageStartupMessages</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(httr))
    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/message">suppressPackageStartupMessages</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(tidyverse))
    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/message">suppressPackageStartupMessages</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(magrittr))
    
    <span class="kw">checkAuthentication</span>()
    
    baseUrl &lt;-<span class="st"> 'https://sandbox-api.brewerydb.com/v2'</span>
    
    endpoint <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">'/?key='</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Sys.getenv">Sys.getenv</a></span>(<span class="st">'brewerydbKey'</span>))
  
    <span class="cf">if</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(params) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) endpoint <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">'&amp;'</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/URLencode">URLencode</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(params), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">as.character</a></span>(params), <span class="dt">sep =</span> <span class="st">'='</span>), <span class="dt">collapse =</span> <span class="st">'&amp;'</span>)))
  
    request &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(verb, <span class="st">'("'</span>, baseUrl, endpoint, <span class="st">'", accept_json())'</span>)
  
    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/eval">eval</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/parse">parse</a></span>(<span class="dt">text =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">'response &lt;- '</span>, request)))
    
    <span class="cf">if</span>(response<span class="op">$</span>status_code <span class="op">&lt;</span><span class="st"> </span><span class="dv">300</span>){
      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/httr/topics/content">content</a></span>(response))
    }<span class="cf">else</span>{
      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/stop">stop</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/httr/topics/content">content</a></span>(response))
    }
  }

  <span class="co"># Testing it out.</span>
  sampleRequest &lt;-<span class="st"> </span><span class="kw">makeRequest</span>(<span class="st">'/beer/WHQisc'</span>, <span class="st">'GET'</span>)
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(sampleRequest)</code></pre></div>
<pre><code>## $message
## [1] "READ ONLY MODE: Request Successful"
## 
## $data
## $data$id
## [1] "WHQisc"
## 
## $data$name
## [1] "Dragon's Milk"
## 
## $data$nameDisplay
## [1] "Dragon's Milk"
## 
## $data$description
## [1] "A barrel-aged, strong-ale with a soft and rich caramel-malt character intermingled with deep vanilla tones dancing in an oak bath. Unmistakably distinctive and hauntingly remarkable, Dragon's Milk's warming complexity pairs well with smoked meats and cheeses, red meat, or a nice cigar."
## 
## $data$abv
## [1] "11"
## 
## $data$ibu
## [1] "31"
## 
## $data$glasswareId
## [1] 8
## 
## $data$srmId
## [1] 41
## 
## $data$availableId
## [1] 1
## 
## $data$styleId
## [1] 43
## 
## $data$isOrganic
## [1] "N"
## 
## $data$isRetired
## [1] "N"
## 
## $data$labels
## $data$labels$icon
## [1] "https://brewerydb-images.s3.amazonaws.com/beer/WHQisc/upload_2FqQti-icon.png"
## 
## $data$labels$medium
## [1] "https://brewerydb-images.s3.amazonaws.com/beer/WHQisc/upload_2FqQti-medium.png"
## 
## $data$labels$large
## [1] "https://brewerydb-images.s3.amazonaws.com/beer/WHQisc/upload_2FqQti-large.png"
## 
## $data$labels$contentAwareIcon
## [1] "https://brewerydb-images.s3.amazonaws.com/beer/WHQisc/upload_2FqQti-contentAwareIcon.png"
## 
## $data$labels$contentAwareMedium
## [1] "https://brewerydb-images.s3.amazonaws.com/beer/WHQisc/upload_2FqQti-contentAwareMedium.png"
## 
## $data$labels$contentAwareLarge
## [1] "https://brewerydb-images.s3.amazonaws.com/beer/WHQisc/upload_2FqQti-contentAwareLarge.png"
## 
## 
## $data$status
## [1] "verified"
## 
## $data$statusDisplay
## [1] "Verified"
## 
## $data$foodPairings
## [1] "Red meat, smoked foods, balsamic, rich cheese &amp; dark chocolate."
## 
## $data$servingTemperature
## [1] "cool"
## 
## $data$servingTemperatureDisplay
## [1] "Cool - (8-12C/45-54F)"
## 
## $data$originalGravity
## [1] "1.096"
## 
## $data$createDate
## [1] "2012-01-03 02:43:06"
## 
## $data$updateDate
## [1] "2018-11-02 02:15:14"
## 
## $data$glass
## $data$glass$id
## [1] 8
## 
## $data$glass$name
## [1] "Tulip"
## 
## $data$glass$createDate
## [1] "2012-01-03 02:41:33"
## 
## 
## $data$srm
## $data$srm$id
## [1] 41
## 
## $data$srm$name
## [1] "Over 40"
## 
## $data$srm$hex
## [1] "000000"
## 
## 
## $data$available
## $data$available$id
## [1] 1
## 
## $data$available$name
## [1] "Year Round"
## 
## $data$available$description
## [1] "Available year round as a staple beer."
## 
## 
## $data$style
## $data$style$id
## [1] 43
## 
## $data$style$categoryId
## [1] 3
## 
## $data$style$category
## $data$style$category$id
## [1] 3
## 
## $data$style$category$name
## [1] "North American Origin Ales"
## 
## $data$style$category$createDate
## [1] "2012-03-21 20:06:45"
## 
## 
## $data$style$name
## [1] "American-Style Imperial Stout"
## 
## $data$style$shortName
## [1] "American Imperial Stout"
## 
## $data$style$description
## [1] "Black in color, American-style imperial stouts typically have a high alcohol content. Generally characterized as very robust. The extremely rich malty flavor and aroma are balanced with assertive hopping and fruity-ester characteristics. Bitterness should be moderately high to very high and balanced with full sweet malt character. Roasted malt astringency and bitterness can be moderately perceived but should not overwhelm the overall character. Hop aroma is usually moderately-high to overwhelmingly hop-floral, -citrus or -herbal. Diacetyl (butterscotch) levels should be absent."
## 
## $data$style$ibuMin
## [1] "50"
## 
## $data$style$ibuMax
## [1] "80"
## 
## $data$style$abvMin
## [1] "7"
## 
## $data$style$abvMax
## [1] "12"
## 
## $data$style$srmMin
## [1] "40"
## 
## $data$style$srmMax
## [1] "40"
## 
## $data$style$ogMin
## [1] "1.08"
## 
## $data$style$fgMin
## [1] "1.02"
## 
## $data$style$fgMax
## [1] "1.03"
## 
## $data$style$createDate
## [1] "2012-03-21 20:06:46"
## 
## $data$style$updateDate
## [1] "2015-04-07 15:28:49"
## 
## 
## 
## $status
## [1] "success"</code></pre>
<p><br></p>
<p>As you can see, the return type is JSON formatted. We can use the <a href="https://cran.r-project.org/web/packages/jsonlite/vignettes/json-aaquickstart.html">jsonlite package</a> to convert this into something more manageable.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="co"># This function consistently flattens a json list into a dataframe.</span>
flattenJsonList &lt;-<span class="st"> </span><span class="cf">function</span>(jsonList){
  
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(dplyr)
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(jsonlite)
  
  <span class="co"># If jsonList is not a named list, make it one.</span>
  <span class="cf">if</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(jsonList[[<span class="dv">1</span>]])) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>){ 
    
    jsonList &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(jsonList)
    
  }
  
  <span class="cf">for</span>(item <span class="cf">in</span> jsonList){
    
    item &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(item, <span class="dt">stringsAsFactors =</span> F)
   
    <span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/exists">exists</a></span>(<span class="st">'df'</span>, <span class="dt">inherits =</span> <span class="ot">FALSE</span>)){
      df &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/jsonlite/topics/flatten">flatten</a></span>(item) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.data.frame">as.data.frame</a></span>()
    }<span class="cf">else</span>{
      df &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>(df, <span class="kw"><a href="https://www.rdocumentation.org/packages/jsonlite/topics/flatten">flatten</a></span>(item) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.data.frame">as.data.frame</a></span>())
    }
  }
  
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(df)
}

  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="kw">flattenJsonList</span>(sampleRequest<span class="op">$</span>data) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.data.frame">as.data.frame</a></span>())</code></pre></div>
<pre><code>##       id          name   nameDisplay
## 1 WHQisc Dragon's Milk Dragon's Milk
##                                                                                                                                                                                                                                                                                      description
## 1 A barrel-aged, strong-ale with a soft and rich caramel-malt character intermingled with deep vanilla tones dancing in an oak bath. Unmistakably distinctive and hauntingly remarkable, Dragon's Milk's warming complexity pairs well with smoked meats and cheeses, red meat, or a nice cigar.
##   abv ibu glasswareId srmId availableId styleId isOrganic isRetired
## 1  11  31           8    41           1      43         N         N
##                                                                    labels.icon
## 1 https://brewerydb-images.s3.amazonaws.com/beer/WHQisc/upload_2FqQti-icon.png
##                                                                    labels.medium
## 1 https://brewerydb-images.s3.amazonaws.com/beer/WHQisc/upload_2FqQti-medium.png
##                                                                    labels.large
## 1 https://brewerydb-images.s3.amazonaws.com/beer/WHQisc/upload_2FqQti-large.png
##                                                                    labels.contentAwareIcon
## 1 https://brewerydb-images.s3.amazonaws.com/beer/WHQisc/upload_2FqQti-contentAwareIcon.png
##                                                                    labels.contentAwareMedium
## 1 https://brewerydb-images.s3.amazonaws.com/beer/WHQisc/upload_2FqQti-contentAwareMedium.png
##                                                                    labels.contentAwareLarge
## 1 https://brewerydb-images.s3.amazonaws.com/beer/WHQisc/upload_2FqQti-contentAwareLarge.png
##     status statusDisplay
## 1 verified      Verified
##                                                      foodPairings
## 1 Red meat, smoked foods, balsamic, rich cheese &amp; dark chocolate.
##   servingTemperature servingTemperatureDisplay originalGravity
## 1               cool     Cool - (8-12C/45-54F)           1.096
##            createDate          updateDate glass.id glass.name
## 1 2012-01-03 02:43:06 2018-11-02 02:15:14        8      Tulip
##      glass.createDate srm.id srm.name srm.hex available.id available.name
## 1 2012-01-03 02:41:33     41  Over 40  000000            1     Year Round
##                    available.description style.id style.categoryId
## 1 Available year round as a staple beer.       43                3
##   style.category.id        style.category.name style.category.createDate
## 1                 3 North American Origin Ales       2012-03-21 20:06:45
##                      style.name         style.shortName
## 1 American-Style Imperial Stout American Imperial Stout
##                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          style.description
## 1 Black in color, American-style imperial stouts typically have a high alcohol content. Generally characterized as very robust. The extremely rich malty flavor and aroma are balanced with assertive hopping and fruity-ester characteristics. Bitterness should be moderately high to very high and balanced with full sweet malt character. Roasted malt astringency and bitterness can be moderately perceived but should not overwhelm the overall character. Hop aroma is usually moderately-high to overwhelmingly hop-floral, -citrus or -herbal. Diacetyl (butterscotch) levels should be absent.
##   style.ibuMin style.ibuMax style.abvMin style.abvMax style.srmMin
## 1           50           80            7           12           40
##   style.srmMax style.ogMin style.fgMin style.fgMax    style.createDate
## 1           40        1.08        1.02        1.03 2012-03-21 20:06:46
##      style.updateDate
## 1 2015-04-07 15:28:49</code></pre>
</div>
<div id="api-documentation---r-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#api-documentation---r-functions" class="anchor"></a>API Documentation -&gt; R Functions</h3>
<p><br></p>
<p>For the example above, the documenation is all about Beer which I’ll call our object. Clicking around on the endpoint pages, we see that documentation pages can be used as object names. The current page is “beer-index”, and is followed below by “beer-adjunct” and “beer-brewery”. Other examples include “brewery-index” and “brewery-beer”, so it makes sense to scrape a page to correspond to our object name.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/message">suppressPackageStartupMessages</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(tidyverse))

  <span class="co"># Eventually we'd like to scrape the whole site so let's prepare.</span>
  pages =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'beer-index'</span>, <span class="st">'beer-adjunct'</span>, <span class="st">'beer-brewery'</span>)

  <span class="cf">for</span>(page <span class="cf">in</span> pages){ 
    
     object &lt;-<span class="st"> </span>page <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_replace</span>(<span class="st">'-'</span>, <span class="st">' '</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_to_title</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_replace</span>(<span class="st">' '</span>, <span class="st">''</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_replace</span>(<span class="st">'Index'</span>, <span class="st">''</span>)
    
     <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(object)
  }</code></pre></div>
<pre><code>## [1] "Beer"
## [1] "BeerAdjunct"
## [1] "BeerBrewery"</code></pre>
<p><br></p>
<p>The beer-index page lists API methods for interacting with Beer objects. These five main sections spell out a logical method for generating function names.</p>
<p><br></p>
<table class="table">
<colgroup>
<col width="21%">
<col width="8%">
<col width="15%">
<col width="20%">
<col width="34%">
</colgroup>
<thead><tr class="header">
<th align="center">Documentation</th>
<th align="center">Method</th>
<th align="center">Endpoint URL</th>
<th align="center">R Function</th>
<th align="center">What it does</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">GET: /beers</td>
<td align="center">GET</td>
<td align="center">/beers</td>
<td align="center">getEveryBeer(…)</td>
<td align="center">Lists every beer</td>
</tr>
<tr class="even">
<td align="center">GET: /beer/:beerId</td>
<td align="center">GET</td>
<td align="center">/beer/:beerId</td>
<td align="center">getBeer(…)</td>
<td align="center">Gets details on a specific beer</td>
</tr>
<tr class="odd">
<td align="center">POST: /beers</td>
<td align="center">POST</td>
<td align="center">/beers</td>
<td align="center">createBeer(…)</td>
<td align="center">Creates a new beer</td>
</tr>
<tr class="even">
<td align="center">PUT: /beer/:beerId</td>
<td align="center">PUT</td>
<td align="center">/beer/:beerId</td>
<td align="center">modifyBeer(…)</td>
<td align="center">Modifies a specific beer</td>
</tr>
<tr class="odd">
<td align="center">DELETE: /beer/:beerId</td>
<td align="center">DELETE</td>
<td align="center">/beer/:beerId</td>
<td align="center">deleteBeer(…)</td>
<td align="center">Deletes a specific beer</td>
</tr>
</tbody>
</table>
<p><br></p>
<p>So how do we go about generating functions? <a href="https://github.com/tidyverse/rvest/blob/master/README.md">The Rvest Package</a>!</p>
<p><br></p>
</div>
<div id="scraping-html-api-documentation" class="section level3">
<h3 class="hasAnchor">
<a href="#scraping-html-api-documentation" class="anchor"></a>Scraping HTML API Documentation</h3>
<p><br></p>
<p>Once we have identified where on the screen are the API methods and endpoints, we need to pull that information into R. Rvest allows us to search a static web page for html nodes and attributes. I find it easiest to use a tool like <a href="https://chrome.google.com/webstore/search/selector%20gadget">Google Chrome’s Selector Gadget</a> to identify the specific HTML elements to scrape.</p>
<div class="figure">
<img src="images/selectorGadget.png" alt=" Selector Gadget in the Chrome Web Store"><p class="caption"><br><i>Selector Gadget in the Chrome Web Store</i></p>
</div>
<p><br></p>
<p>Let’s get scraping! It turns out that our method/endpoint texts correspond to “h3 span” elements. They will need to be split on the colon right after the api method text. Eg. “GET:” /beers" becomes apiMethod “GET” and endpoint “/beers”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/message">suppressPackageStartupMessages</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(rvest))
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/message">suppressPackageStartupMessages</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(magrittr))

  functionsUrl &lt;-<span class="st"> 'https://www.brewerydb.com/developers/docs/endpoint/'</span>
  
  <span class="co"># Eventually we'll expand this to all pages.</span>
  <span class="cf">for</span>(page <span class="cf">in</span> <span class="st">'beer-index'</span>){ 
    
    html &lt;-<span class="st"> </span><span class="kw">read_html</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(functionsUrl, page))
  
    <span class="co"># Each method becomes a function.</span>
    apiMethods &lt;-<span class="st"> </span>html <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/rvest/topics/html_nodes">html_nodes</a></span>(<span class="st">'h3 span'</span>) <span class="op">%&gt;%</span><span class="st"> </span>rvest<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/rvest/topics/html_text">html_text</a></span>()
    
    methodsAndEndpoints &lt;-<span class="st"> </span><span class="ot">NULL</span>
    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(apiMethods)){
      
      apiMethodText &lt;-<span class="st"> </span>apiMethods[[i]]
      
      <span class="co"># Grab api method (GET, POST, PUT, DELETE)</span>
      apiMethod &lt;-<span class="st"> </span><span class="kw">str_sub</span>(apiMethodText, <span class="dv">1</span>, apiMethodText <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_locate</span>(<span class="st">':'</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/magrittr/topics/aliases">extract2</a></span>(<span class="dv">1</span>) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)
      
      <span class="co"># Grab endpoint for request.</span>
      endpoint &lt;-<span class="st"> </span>apiMethodText <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_sub</span>(apiMethodText <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_locate</span>(<span class="st">':'</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/magrittr/topics/aliases">extract2</a></span>(<span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="dv">2</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nchar">nchar</a></span>(apiMethodText))
      
      methodsAndEndpoints &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>(methodsAndEndpoints, <span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="dt">Method =</span> apiMethod, <span class="dt">Endpoint =</span> endpoint))
    }
    
    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(methodsAndEndpoints)
  }</code></pre></div>
<pre><code>## # A tibble: 5 x 2
##   Method Endpoint     
##   &lt;chr&gt;  &lt;chr&gt;        
## 1 GET    /beers       
## 2 GET    /beer/:beerId
## 3 POST   /beers       
## 4 PUT    /beer/:beerId
## 5 DELETE /beer/:beerId</code></pre>
<p><br></p>
<p>Just for funzies, let’s run it on some more pages to make sure the documentation is consistent.</p>
<p><br></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  pages &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'beer-index'</span>, <span class="st">'beer-adjunct'</span>, <span class="st">'beer-brewery'</span>)

  <span class="co"># Eventually we'll expand this to all pages.</span>
  <span class="cf">for</span>(page <span class="cf">in</span> pages){ 
    
    html &lt;-<span class="st"> </span><span class="kw">read_html</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(functionsUrl, page))
  
    <span class="co"># Each method becomes a function.</span>
    apiMethods &lt;-<span class="st"> </span>html <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/rvest/topics/html_nodes">html_nodes</a></span>(<span class="st">'h3 span'</span>) <span class="op">%&gt;%</span><span class="st"> </span>rvest<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/rvest/topics/html_text">html_text</a></span>()
    
    methodsAndEndpoints &lt;-<span class="st"> </span><span class="ot">NULL</span>
    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(apiMethods)){
      
      apiMethodText &lt;-<span class="st"> </span>apiMethods[[i]]
      
      <span class="co"># Grab api method (GET, POST, PUT, DELETE)</span>
      apiMethod &lt;-<span class="st"> </span><span class="kw">str_sub</span>(apiMethodText, <span class="dv">1</span>, apiMethodText <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_locate</span>(<span class="st">':'</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/magrittr/topics/aliases">extract2</a></span>(<span class="dv">1</span>) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)
      
      <span class="co"># Grab endpoint for request.</span>
      endpoint &lt;-<span class="st"> </span>apiMethodText <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_sub</span>(apiMethodText <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_locate</span>(<span class="st">':'</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/magrittr/topics/aliases">extract2</a></span>(<span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="dv">2</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nchar">nchar</a></span>(apiMethodText))
      
      methodsAndEndpoints &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>(methodsAndEndpoints, <span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="dt">Method =</span> apiMethod, <span class="dt">Endpoint =</span> endpoint))
    }
    
    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(page)
    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(methodsAndEndpoints)
  }</code></pre></div>
<pre><code>## [1] "beer-index"
## # A tibble: 5 x 2
##   Method Endpoint     
##   &lt;chr&gt;  &lt;chr&gt;        
## 1 GET    /beers       
## 2 GET    /beer/:beerId
## 3 POST   /beers       
## 4 PUT    /beer/:beerId
## 5 DELETE /beer/:beerId
## [1] "beer-adjunct"
## # A tibble: 3 x 2
##   Method Endpoint                        
##   &lt;chr&gt;  &lt;chr&gt;                           
## 1 GET    /beer/:beerId/adjuncts          
## 2 POST   /beer/:beerId/adjuncts          
## 3 DELETE /beer/:beerId/adjunct/:adjunctId
## [1] "beer-brewery"
## # A tibble: 3 x 2
##   Method Endpoint                        
##   &lt;chr&gt;  &lt;chr&gt;                           
## 1 GET    /beer/:beerId/breweries         
## 2 POST   /beer/:beerId/breweries         
## 3 DELETE /beer/:beerId/brewery/:breweryId</code></pre>
<p><br></p>
<p>Now we’re cooking. While we’re at it, could we scrape the page name of each documentation page we will want functions for? It turns out that each of those page labels are “li a” elements on the documentation page. Finding those elements and grabbing their ‘href’ attribute will give us each page URL we’ll need.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="co"># This function returns all api endpoint pages.</span>
  getAllAPIpages &lt;-<span class="st"> </span><span class="cf">function</span>(){
    
    html &lt;-<span class="st"> </span><span class="kw">read_html</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(functionsUrl))
    
    pages &lt;-<span class="st"> </span>html <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/rvest/topics/html_nodes">html_nodes</a></span>(<span class="st">'li a'</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/rvest/topics/html_text">html_attr</a></span>(<span class="st">'href'</span>)
    
    pages &lt;-<span class="st"> </span>pages[pages <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_which</span>(<span class="st">'/developers/docs/endpoint/'</span>)] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_replace_all</span>(<span class="st">'/developers/docs/endpoint/'</span>, <span class="st">''</span>)
    
    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(pages)
  }

  <span class="kw">getAllAPIpages</span>()</code></pre></div>
<pre><code>##  [1] "adjunct-index"         "beer-index"           
##  [3] "beer-adjunct"          "beer-brewery"         
##  [5] "beer-event"            "beer-fermentable"     
##  [7] "beer-hop"              "beer-ingredient"      
##  [9] "beer-random"           "beer-socialaccount"   
## [11] "beer-upc"              "beer-variation"       
## [13] "beer-yeast"            "brewery-index"        
## [15] "brewery-alternatename" "brewery-beer"         
## [17] "brewery-event"         "brewery-guild"        
## [19] "brewery-location"      "brewery-random"       
## [21] "brewery-socialaccount" "category-index"       
## [23] "change-index"          "convertid-index"      
## [25] "event-index"           "event-awardcategory"  
## [27] "event-awardplace"      "event-beer"           
## [29] "event-brewery"         "event-socialaccount"  
## [31] "feature-index"         "fermentable-index"    
## [33] "fluidsize-index"       "glass-index"          
## [35] "guild-index"           "guild-brewery"        
## [37] "guild-socialaccount"   "heartbeat-index"      
## [39] "hop-index"             "ingredient-index"     
## [41] "location-index"        "menu-index"           
## [43] "search-index"          "search-geopoint"      
## [45] "search-style"          "search-upc"           
## [47] "socialsite-index"      "style-index"          
## [49] "yeast-index"</code></pre>
<p><br></p>
<p>So how do we translate the api method and endpoint into a function? Let’s start by generating the easiest function: getEveryBeer(…).</p>
</div>
<div id="generating--r-files" class="section level3">
<h3 class="hasAnchor">
<a href="#generating--r-files" class="anchor"></a>Generating .R Files</h3>
<p><br></p>
<p>The <a href="https://readr.tidyverse.org">readr package</a> has a very handy function called write_lines(x, path, append) which will write text to a given file. If we’re clever with it we can generate a .R file with functions on the fly. write_lines will also generate any files that don’t already exist.</p>
<p><br></p>
<p>Let’s see an example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  functionText &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">'</span><span class="ch">\n\t</span><span class="st">return(text)</span><span class="ch">\n\n</span><span class="st">}'</span>)

  <span class="kw">write_lines</span>(<span class="st">'helloWorld &lt;- function(text = "Hello World!"){</span><span class="ch">\n</span><span class="st">'</span>, <span class="st">'helloWorld.R'</span>)
  <span class="kw">write_lines</span>(<span class="st">'</span><span class="ch">\t</span><span class="st">return(text)</span><span class="ch">\n</span><span class="st">'</span>, <span class="st">'helloWorld.R'</span>, <span class="dt">append =</span> T)
  <span class="kw">write_lines</span>(<span class="st">'}'</span>, <span class="st">'helloWorld.R'</span>, <span class="dt">append =</span> T)
  
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/source">source</a></span>(<span class="st">'helloWorld.R'</span>)
  
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(helloWorld)</code></pre></div>
<pre><code>## function (text = "Hello World!") 
## {
##     return(text)
## }</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="kw">helloWorld</span>())</code></pre></div>
<pre><code>## [1] "Hello World!"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/files">file.remove</a></span>(<span class="st">'helloWorld.R'</span>)</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p><br></p>
<p>So how do we generate getEveryBeer(…)? The general structure is easy but the API method has many parameters we need to make it fully functional. We can scrape those using Rvest too. It turns out using Selector Gadget that each table of parameters has an element id of “param_0”, “param_1”, one for each API method or function we will generate.</p>
<p><br></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  html &lt;-<span class="st"> </span><span class="kw">read_html</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(functionsUrl, <span class="st">'beer-index'</span>))

  <span class="co"># Each method becomes a function.</span>
  apiMethods &lt;-<span class="st"> </span>html <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/rvest/topics/html_nodes">html_nodes</a></span>(<span class="st">'h3 span'</span>) <span class="op">%&gt;%</span><span class="st"> </span>rvest<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/rvest/topics/html_text">html_text</a></span>()

  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(apiMethods)){
    <span class="co"># Grab function parameters. //*[(@id = "params_0")]</span>
        params &lt;-<span class="st"> </span>html <span class="op">%&gt;%</span><span class="st"> </span>rvest<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/rvest/topics/html_nodes">html_nodes</a></span>(<span class="dt">xpath =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">'////*[(@id = "params_'</span>, i<span class="op">-</span><span class="dv">1</span>, <span class="st">'")]'</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/rvest/topics/html_text">html_children</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/magrittr/topics/aliases">extract2</a></span>(<span class="dv">2</span>)
        
        <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(params <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/rvest/topics/html_text">html_name</a></span>() <span class="op">==</span><span class="st"> 'table'</span>, params <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/rvest/topics/html_table">html_table</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_all</a></span>(str_squish), params &lt;-<span class="st"> </span><span class="ot">NA</span>)
        
        <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NA">is.na</a></span>(params), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(params <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_all</a></span>(<span class="cf">function</span>(x) <span class="kw">str_sub</span>(x, <span class="dt">start =</span> <span class="dv">1</span>, <span class="dt">end =</span> <span class="dv">30</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>()), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(params))
  }</code></pre></div>
<pre><code>##     Parameter                    Description Access Restriction
## 1           p                    Page Number               None
## 2         ids ID's of the beers to return, c               None
## 3        name                Name of a beer.               None
## 4         abv ABV for a beer. Premium users                None
## 5         ibu IBUs for a beer. Premium users               None
## 6 glasswareId               ID for glassware               None
##            Parameter                    Description Access Restriction
## 1      withBreweries Get beer results with brewery                None
## 2 withSocialAccounts Get beer results with social a               None
## 3    withIngredients Get beer results with ingredie               None
##          Parameter                    Description Access Restriction
## 1    name Required               Name of the beer               None
## 2 styleId Required ID corresponding to the approp               None
## 3      description    A little bit about the beer               None
## 4              abv     ABV percentage of the beer               None
## 5              ibu      Measured IBUs of the beer               None
## 6      glasswareId ID corresponding to the approp               None
##          Parameter                    Description Access Restriction
## 1    name Required               Name of the beer               None
## 2 styleId Required ID corresponding to the approp               None
## 3      description    A little bit about the beer               None
## 4              abv     ABV percentage of the beer               None
## 5              ibu      Measured IBUs of the beer               None
## 6      glasswareId ID corresponding to the approp               None
## [1] NA</code></pre>
<p><br></p>
<p>And now we’re ready to make our function. We make a variable called functionText to contain the string of our function which we will then use write_lines on to create the text in our .R file. Let’s start putting it together.</p>
<p><br></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  functionsUrl &lt;-<span class="st"> 'https://www.brewerydb.com/developers/docs/endpoint/'</span>

  <span class="co"># Eventually we'd like to scrape the whole site so lets prepare.</span>
  pages &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'beer-index'</span>)

  <span class="cf">for</span>(page <span class="cf">in</span> pages){ 
    
     object &lt;-<span class="st"> </span>page <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_replace</span>(<span class="st">'-'</span>, <span class="st">' '</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_to_title</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_replace</span>(<span class="st">' '</span>, <span class="st">''</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_replace</span>(<span class="st">'Index'</span>, <span class="st">''</span>)
 
    <span class="co"># Name the file "Beer.R"</span>
    filepath &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(object, <span class="st">".R"</span>)
      
    <span class="co"># Instantiate the .R file.</span>
    <span class="kw">write_lines</span>(<span class="st">''</span>, filepath)
       
    html &lt;-<span class="st"> </span><span class="kw">read_html</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(functionsUrl, page))
  
    <span class="co"># Each method becomes a function.</span>
    apiMethods &lt;-<span class="st"> </span>html <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/rvest/topics/html_nodes">html_nodes</a></span>(<span class="st">'h3 span'</span>) <span class="op">%&gt;%</span><span class="st"> </span>rvest<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/rvest/topics/html_text">html_text</a></span>()
  
    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(apiMethods)){
      
      apiMethodText &lt;-<span class="st"> </span>apiMethods[[i]]
      
      <span class="co"># Grab API method (GET, POST, PUT, DELETE)</span>
      apiMethod &lt;-<span class="st"> </span><span class="kw">str_sub</span>(apiMethodText, <span class="dv">1</span>, apiMethodText <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_locate</span>(<span class="st">':'</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/magrittr/topics/aliases">extract2</a></span>(<span class="dv">1</span>) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)
      
      <span class="co"># Grab endpoint for request.</span>
      endpoint &lt;-<span class="st"> </span>apiMethodText <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_sub</span>(apiMethodText <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_locate</span>(<span class="st">':'</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/magrittr/topics/aliases">extract2</a></span>(<span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="dv">2</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nchar">nchar</a></span>(apiMethodText))
      
      <span class="co"># Grab function parameters. //*[(@id = "params_0")], etc.</span>
          params &lt;-<span class="st"> </span>html <span class="op">%&gt;%</span><span class="st"> </span>rvest<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/rvest/topics/html_nodes">html_nodes</a></span>(<span class="dt">xpath =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">'////*[(@id = "params_'</span>, i<span class="op">-</span><span class="dv">1</span>, <span class="st">'")]'</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/rvest/topics/html_text">html_children</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/magrittr/topics/aliases">extract2</a></span>(<span class="dv">2</span>)
          
          <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(params <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/rvest/topics/html_text">html_name</a></span>() <span class="op">==</span><span class="st"> 'table'</span>, params <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/rvest/topics/html_table">html_table</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_all</a></span>(str_squish), params &lt;-<span class="st"> </span><span class="ot">NA</span>)
          
  <span class="co"># Replace API methods with human-readable functions. getEvery(object), get(object), create(object), update(object), delete(object).</span>
        functionName &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'get'</span>, <span class="st">'create'</span>, <span class="st">'update'</span>, <span class="st">'delete'</span>)[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/which">which</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'GET'</span>, <span class="st">'POST'</span>, <span class="st">'PUT'</span>, <span class="st">'DELETE'</span>) <span class="op">==</span><span class="st"> </span>apiMethod)]
        <span class="cf">if</span>(endpoint <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_sub</span>(<span class="op">-</span><span class="dv">2</span>, <span class="op">-</span><span class="dv">1</span>) <span class="op">!=</span><span class="st"> 'Id'</span> <span class="op">&amp;</span><span class="st"> </span>apiMethod <span class="op">!=</span><span class="st"> 'POST'</span>) functionName <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">'Every'</span>)
        functionName <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(object)
  
      <span class="co"># Start the function text that will contain the string of our functions to be written to our .R file.</span>
      functionText &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(functionName, <span class="st">' &lt;- function('</span>)
      
      <span class="co"># Add params to functions.</span>
      <span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NA">is.na</a></span>(params)){
        <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(params)){
       
          param &lt;-<span class="st"> </span>params<span class="op">$</span>Parameter[[i]] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_replace</span>(<span class="st">' Required'</span>, <span class="st">''</span>)
       
          functionText <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(i <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, param, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">', '</span>, param)))
        }
      }     
         
      functionText <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">'){</span><span class="ch">\n\n</span><span class="st">'</span>)
      
      functionText <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">'</span><span class="ch">\t</span><span class="st">params &lt;- as.list(environment())</span><span class="ch">\n\t</span><span class="st">params &lt;- params[params != ""]</span><span class="ch">\n\n</span><span class="st">'</span>)
      
      functionText <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">'</span><span class="ch">\t</span><span class="st">endpoint &lt;- "'</span>, endpoint, <span class="st">'"</span><span class="ch">\n\n</span><span class="st">'</span>)
      
      
      <span class="co"># Create the API call.</span>
      functionText <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">'</span><span class="ch">\t</span><span class="st">returnData &lt;- makeRequest(endpoint, "'</span>, apiMethod, <span class="st">'", params)</span><span class="ch">\n\n</span><span class="st">'</span>)
  
      functionText <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">'</span><span class="ch">\t</span><span class="st">flattenJsonList(returnData$data)</span><span class="ch">\n\n</span><span class="st">}</span><span class="ch">\n\n</span><span class="st">'</span>)
      
      <span class="kw">write_lines</span>(functionText, filepath, <span class="dt">append =</span> T)
    }
   
    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/source">source</a></span>(filepath)
      
    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="kw"><a href="../../reference/getEveryBeer.html">getEveryBeer</a></span>(<span class="dt">name =</span> <span class="st">"Dragon's Milk"</span>))
    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/files">file.remove</a></span>(filepath)
  }</code></pre></div>
<pre><code>##       id          name   nameDisplay
## 1 WHQisc Dragon's Milk Dragon's Milk
##                                                                                                                                                                                                                                                                                      description
## 1 A barrel-aged, strong-ale with a soft and rich caramel-malt character intermingled with deep vanilla tones dancing in an oak bath. Unmistakably distinctive and hauntingly remarkable, Dragon's Milk's warming complexity pairs well with smoked meats and cheeses, red meat, or a nice cigar.
##   abv ibu glasswareId srmId availableId styleId isOrganic isRetired
## 1  11  31           8    41           1      43         N         N
##                                                                    labels.icon
## 1 https://brewerydb-images.s3.amazonaws.com/beer/WHQisc/upload_2FqQti-icon.png
##                                                                    labels.medium
## 1 https://brewerydb-images.s3.amazonaws.com/beer/WHQisc/upload_2FqQti-medium.png
##                                                                    labels.large
## 1 https://brewerydb-images.s3.amazonaws.com/beer/WHQisc/upload_2FqQti-large.png
##                                                                    labels.contentAwareIcon
## 1 https://brewerydb-images.s3.amazonaws.com/beer/WHQisc/upload_2FqQti-contentAwareIcon.png
##                                                                    labels.contentAwareMedium
## 1 https://brewerydb-images.s3.amazonaws.com/beer/WHQisc/upload_2FqQti-contentAwareMedium.png
##                                                                    labels.contentAwareLarge
## 1 https://brewerydb-images.s3.amazonaws.com/beer/WHQisc/upload_2FqQti-contentAwareLarge.png
##     status statusDisplay
## 1 verified      Verified
##                                                      foodPairings
## 1 Red meat, smoked foods, balsamic, rich cheese &amp; dark chocolate.
##   servingTemperature servingTemperatureDisplay originalGravity
## 1               cool     Cool - (8-12C/45-54F)           1.096
##            createDate          updateDate glass.id glass.name
## 1 2012-01-03 02:43:06 2018-11-02 02:15:14        8      Tulip
##      glass.createDate srm.id srm.name srm.hex available.id available.name
## 1 2012-01-03 02:41:33     41  Over 40  000000            1     Year Round
##                    available.description style.id style.categoryId
## 1 Available year round as a staple beer.       43                3
##   style.category.id        style.category.name style.category.createDate
## 1                 3 North American Origin Ales       2012-03-21 20:06:45
##                      style.name         style.shortName
## 1 American-Style Imperial Stout American Imperial Stout
##                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          style.description
## 1 Black in color, American-style imperial stouts typically have a high alcohol content. Generally characterized as very robust. The extremely rich malty flavor and aroma are balanced with assertive hopping and fruity-ester characteristics. Bitterness should be moderately high to very high and balanced with full sweet malt character. Roasted malt astringency and bitterness can be moderately perceived but should not overwhelm the overall character. Hop aroma is usually moderately-high to overwhelmingly hop-floral, -citrus or -herbal. Diacetyl (butterscotch) levels should be absent.
##   style.ibuMin style.ibuMax style.abvMin style.abvMax style.srmMin
## 1           50           80            7           12           40
##   style.srmMax style.ogMin style.fgMin style.fgMax    style.createDate
## 1           40        1.08        1.02        1.03 2012-03-21 20:06:46
##      style.updateDate
## 1 2015-04-07 15:28:49</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Sam Terfa.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
